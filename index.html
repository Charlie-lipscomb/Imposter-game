<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Imposter Lobby</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
#game { display: none; }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, get, child, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDlm1nd6P6VY6HiFLgy2rZPeLLr-VwYaD4",
  authDomain: "imposter-5142b.firebaseapp.com",
  databaseURL: "https://imposter-5142b-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "imposter-5142b",
  storageBucket: "imposter-5142b.firebasestorage.app",
  messagingSenderId: "500677632460",
  appId: "1:500677632460:web:236568f1cb93c31a7bbd69",
  measurementId: "G-RWF1030VF1"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

function generateCode() {
  return Math.random().toString(36).substring(2, 7).toUpperCase();
}

window.createLobby = async function () {
  const name = document.getElementById("playerName").value.trim();
  if (!name) return alert("Enter your name");

  const code = generateCode();
  const lobbyRef = ref(db, `lobbies/${code}`);

  try {
    await set(lobbyRef, {
      players: { [name]: true }
    });
    joinLobbyUI(code, name);
  } catch (err) {
    alert("Failed to create lobby: " + err.message);
  }
};

window.joinLobby = async function () {
  const name = document.getElementById("playerName").value.trim();
  const code = document.getElementById("lobbyCode").value.trim().toUpperCase();
  if (!name || !code) return alert("Enter name and code");

  const lobbyRef = ref(db, `lobbies/${code}`);
  const snap = await get(lobbyRef);

  if (!snap.exists()) return alert("Lobby not found");

  try {
    await set(ref(db, `lobbies/${code}/players/${name}`), true);
    joinLobbyUI(code, name);
  } catch (err) {
    alert("Error joining: " + err.message);
  }
};

function joinLobbyUI(code, name) {
  document.getElementById("lobby").style.display = "none";
  document.getElementById("game").style.display = "block";
  document.getElementById("codeDisplay").innerText = code;

  const playersRef = ref(db, `lobbies/${code}/players`);
  onValue(playersRef, snap => {
    const list = document.getElementById("playerList");
    list.innerHTML = "";
    snap.forEach(child => {
      const li = document.createElement("li");
      li.textContent = child.key;
      list.appendChild(li);
    });
  });
}
</script>
</head>
<body>
<div id="lobby">
  <h2>Imposter Lobby</h2>
  <input id="playerName" placeholder="Your name" />
  <br><br>
  <button onclick="createLobby()">Create Lobby</button>
  <br><br>
  <input id="lobbyCode" placeholder="Code to join" />
  <button onclick="joinLobby()">Join</button>
</div>

<div id="game">
  <h2>Lobby Code: <span id="codeDisplay"></span></h2>
  <h3>Players:</h3>
  <ul id="playerList"></ul>
</div>
</body>
</html>
